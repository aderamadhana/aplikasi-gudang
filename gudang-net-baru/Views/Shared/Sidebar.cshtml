@{
    var controller = ViewContext.RouteData.Values["controller"]?.ToString();
    var action = ViewContext.RouteData.Values["action"]?.ToString(); 
    var user = await userManager.GetUserAsync(User);
    var roles = user != null ? await userManager.GetRolesAsync(user) : new List<string>();
    var session_role = @Context.Session.GetString("UserRole");
}

@using Microsoft.AspNetCore.Identity;
@inject SignInManager<ApplicationUser> signInManager;
@inject UserManager<ApplicationUser> userManager;

<aside class="sidebar d-none d-lg-flex p-3">
    <div class="d-flex flex-column w-100">
        <div class="nav-section">Ganti Role</div>
        <select id="roleSelect" class="form-select form-select-sm text-uppercase fw-bold">
            @foreach (var role in roles)
            {
                <option value="@role" selected="@(role == session_role)">
                    @role.ToUpper()
                </option>
            }
        </select>
        <div class="nav-section">Home</div>
        <a class="nav-link @(controller == "Home" ? "active" : "")" asp-area="" asp-controller="Home" asp-action="Index"><i class="bi bi-grid-1x2"></i> Dashboard</a>

        <div class="nav-section">Master dan Konfigurasi</div>
        <div class="has-submenu @(controller == "Role" || controller == "User" || controller == "Menu" ? "is-open" : "")">
            <button class="submenu-toggle" type="button" aria-expanded="false" aria-controls="konfigurasi">
                <i class="bi bi-send-check"></i> Konfigurasi
                <span class="arrow"><i class="bi bi-caret-down-fill"></i></span>
            </button>
            <div class="submenu @(controller == "Role" || controller == "User" || controller == "Menu" ? "is-open" : "")" id="konfigurasi">
                <a class="nav-link @(controller == "User" ? "active" : "")" asp-area="" asp-controller="User" asp-action="Index">User</a>
                <a class="nav-link @(controller == "Role" ? "active" : "")" asp-area="" asp-controller="Role" asp-action="Index">Role</a>
                <a class="nav-link @(controller == "Menu" ? "active" : "")" asp-area="" asp-controller="Menu" asp-action="Index">Menu</a>
            </div>
        </div>

        <div class="has-submenu @(controller == "Barang" ? "is-open" : "")">
            <button class="submenu-toggle" type="button" aria-expanded="true" aria-controls="master">
                <i class="bi bi-fingerprint"></i> Master
                <span class="arrow"><i class="bi bi-caret-down-fill"></i></span>
            </button>
            <div class="submenu" @(controller == "Barang" ? "is-open" : "")" id="master">
                <a class="nav-link @(controller == "Barang" ? "active" : "")" asp-area="" asp-controller="Barang" asp-action="Index">Barang</a>
            </div>
        </div>
    </div>
</aside>

<!-- Offcanvas (mobile) -->
<div class="offcanvas offcanvas-start" id="offcanvasSidebar" aria-labelledby="offcanvasSidebarLabel">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasSidebarLabel">Menu</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Tutup"></button>
    </div>
    <div class="offcanvas-body">
        <div class="nav-section">Home</div>
        <a class="nav-link @(controller == "Home" ? "active" : "")" asp-area="" asp-controller="Home" asp-action="Index"><i class="bi bi-grid-1x2"></i> Dashboard</a>
        <div class="nav-section">Master dan Konfigurasi</div>
        <div class="has-submenu @(controller == "Role" || controller == "User" || controller == "Menu" ? "is-open" : "")">
            <button class="submenu-toggle" type="button" aria-expanded="false" aria-controls="konfigurasi">
                <i class="bi bi-send-check"></i> Konfigurasi
                <span class="arrow"><i class="bi bi-caret-down-fill"></i></span>
            </button>
            <div class="submenu @(controller == "Role" || controller == "User" || controller == "Menu" ? "is-open" : "")" id="konfigurasi">
                <a class="nav-link @(controller == "User" ? "active" : "")" asp-area="" asp-controller="User" asp-action="Index">User</a>
                <a class="nav-link @(controller == "Role" ? "active" : "")" asp-area="" asp-controller="Role" asp-action="Index">Role</a>
                <a class="nav-link @(controller == "Menu" ? "active" : "")" asp-area="" asp-controller="Menu" asp-action="Index">Menu</a>
            </div>
        </div>

        <div class="has-submenu">
            <button class="submenu-toggle" type="button" aria-expanded="true" aria-controls="master">
                <i class="bi bi-fingerprint"></i> Master
                <span class="arrow"><i class="bi bi-caret-down-fill"></i></span>
            </button>
            <div class="submenu" id="master">
                <a class="nav-link" href="#">Barang</a>
            </div>
        </div>
    </div>
</div>
<script>
    $("#roleSelect").on("change", function () {
        var selectedRole = $(this).val();

        $.post('/Login/SetRoleSession', { role: selectedRole }, function () {
            showAlert("Role berhasil diganti!","success");
           
            setTimeout(function () {
                location.reload();
            }, 1000); // reload setelah 1 detik
        });
    });
</script>